<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AI Chat with Personality</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap');
  body {
    margin: 0; 
    background: #1a0b3d;
    color: #ddd;
    font-family: 'Roboto Mono', monospace;
    display: flex;
    flex-direction: column;
    height: 100vh;
  }
  header {
    background: #2e1a6d;
    padding: 15px 20px;
    text-align: center;
    font-size: 1.5em;
    font-weight: 600;
    color: #b9a1ff;
    letter-spacing: 1px;
  }
  #container {
    flex: 1;
    display: flex;
    flex-direction: column;
    max-width: 700px;
    margin: 20px auto;
    background: #2a1a55;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 0 15px #6e52ffaa;
  }
  label {
    font-weight: 600;
    margin-top: 10px;
    color: #b9a1ff;
  }
  textarea, input[type="text"] {
    width: 100%;
    border-radius: 8px;
    border: none;
    padding: 10px;
    margin-top: 6px;
    font-family: 'Roboto Mono', monospace;
    font-size: 1em;
    background: #3b2a82;
    color: #eee;
    resize: vertical;
    min-height: 80px;
  }
  input[type="text"] {
    height: 40px;
    min-height: auto;
  }
  #chat {
    flex: 1;
    margin-top: 20px;
    background: #271d55;
    border-radius: 8px;
    padding: 15px;
    overflow-y: auto;
    color: #eee;
    font-size: 1.05em;
    line-height: 1.4em;
  }
  .message {
    margin-bottom: 16px;
    max-width: 90%;
  }
  .user {
    color: #aaccff;
    font-weight: 700;
  }
  .ai {
    color: #d3bfff;
  }
  #status {
    margin-top: 8px;
    font-style: italic;
    color: #a48cff;
    min-height: 22px;
  }
  #input-area {
    margin-top: 15px;
    display: flex;
    gap: 10px;
  }
  #userInput {
    flex: 1;
    background: #3b2a82;
    border-radius: 8px;
    border: none;
    padding: 10px;
    color: #eee;
    font-family: 'Roboto Mono', monospace;
    font-size: 1em;
  }
  #sendBtn {
    background: #6e52ff;
    color: white;
    font-weight: 700;
    border: none;
    border-radius: 8px;
    padding: 0 20px;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  #sendBtn:hover {
    background: #8f70ff;
  }
  @media (max-width: 600px) {
    #container {
      margin: 10px;
      padding: 15px;
    }
  }
</style>
</head>
<body>
  <header>AI Chat with Personality</header>
  <div id="container">
    <label for="characterPrompt">AI Personality Prompt (defines AI behavior):</label>
    <textarea id="characterPrompt" rows="4" placeholder="Example: You are a friendly assistant who loves to help with coding and jokes."></textarea>
    
    <div id="chat"></div>
    <div id="status"></div>
    
    <div id="input-area">
      <input type="text" id="userInput" placeholder="Type your message here..." autocomplete="off" />
      <button id="sendBtn">Send</button>
    </div>
  </div>

<script>
  const HF_TOKEN = "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";
  const API_URL = "https://api-inference.huggingface.co/models/gpt2"; // Using GPT-2 as reliable example

  const chatDiv = document.getElementById("chat");
  const statusDiv = document.getElementById("status");
  const sendBtn = document.getElementById("sendBtn");
  const userInput = document.getElementById("userInput");
  const characterPromptEl = document.getElementById("characterPrompt");

  // Keep conversation history to show chat context
  let conversationHistory = "";

  sendBtn.addEventListener("click", () => {
    let text = userInput.value.trim();
    if (!text) return;
    addMessage(text, "user");
    userInput.value = "";
    sendToAI(text);
  });

  userInput.addEventListener("keydown", e => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      sendBtn.click();
    }
  });

  function addMessage(text, sender) {
    const messageEl = document.createElement("div");
    messageEl.className = "message " + sender;
    messageEl.textContent = (sender === "user" ? "You: " : "AI: ") + text;
    chatDiv.appendChild(messageEl);
    chatDiv.scrollTop = chatDiv.scrollHeight;
  }

  async function sendToAI(userText) {
    statusDiv.textContent = "AI is typing...";
    
    // Get the user-defined personality prompt
    const personality = characterPromptEl.value.trim();
    // Compose full prompt for GPT-2 style
    // Include conversation history + new user message
    // Append "AI:" to hint the model to respond as AI
    const prompt = (personality ? personality + "\n\n" : "") +
                   (conversationHistory ? conversationHistory + "\n" : "") +
                   "User: " + userText + "\nAI:";

    try {
      const response = await fetch(API_URL, {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${HF_TOKEN}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          inputs: prompt,
          parameters: {
            max_new_tokens: 150,
            temperature: 0.7,
            top_p: 0.9,
            repetition_penalty: 1.1,
            return_full_text: false
          }
        })
      });

      if (!response.ok) {
        throw new Error(`Error ${response.status}: ${response.statusText}`);
      }

      const data = await response.json();

      // GPT-2 model returns an array with generated text in 'generated_text'
      if (data && data.length && data[0].generated_text) {
        // The model might repeat the prompt, so remove it from generated text
        let aiResponse = data[0].generated_text;
        // Remove prompt from start if present
        if (aiResponse.startsWith(prompt)) {
          aiResponse = aiResponse.slice(prompt.length).trim();
        }
        if (!aiResponse) aiResponse = "[No response generated.]";

        addMessage(aiResponse, "ai");

        // Update conversation history (keep short for performance)
        conversationHistory += `User: ${userText}\nAI: ${aiResponse}\n`;
        if (conversationHistory.length > 1000) {
          conversationHistory = conversationHistory.slice(conversationHistory.length - 1000);
        }
      } else {
        addMessage("[AI did not return a valid response]", "ai");
      }
    } catch (error) {
      addMessage(`[Error: ${error.message}]`, "ai");
    } finally {
      statusDiv.textContent = "";
    }
  }
</script>
</body>
</html>
